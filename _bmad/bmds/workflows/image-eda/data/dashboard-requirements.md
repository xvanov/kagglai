# Streamlit Dashboard Requirements

**Purpose:** Specification for the interactive EDA dashboard generated by Phase 8.

---

## Dashboard Structure

```
experiments/eda/dashboard/
├── app.py              # Main Streamlit application
├── pages/              # Multi-page app structure (optional)
│   ├── 1_overview.py
│   ├── 2_image_browser.py
│   ├── 3_label_analysis.py
│   ├── 4_quality_assessment.py
│   └── 5_insights.py
├── components/         # Reusable components
│   ├── image_viewer.py
│   └── charts.py
└── utils/
    └── data_loader.py
```

---

## Core Components

### 1. Overview Page

**Purpose:** High-level summary of the EDA findings

**Elements:**
- Dataset statistics summary (image count, total size, formats)
- Class distribution chart (bar chart or pie chart)
- Quality breakdown (high/medium/low quality percentages)
- Key insights summary (bullet points)
- Link to detailed sections

### 2. Image Browser

**Purpose:** Interactive exploration of images in the dataset

**Elements:**
- Grid view of image thumbnails (adjustable size)
- Filter by:
  - Class/label
  - Quality level
  - File format
  - Size range
- Click to expand image with:
  - Full resolution view
  - Label overlay toggle
  - Metadata display (dimensions, format, file size)
  - Quality assessment
- Random sample button
- Navigation (next/previous)

### 3. Label Analysis

**Purpose:** Deep dive into labeling quality and distribution

**Elements:**
- Class distribution visualization (interactive bar chart)
- Class imbalance indicator
- Label quality metrics
- Examples of each class (sample images)
- Problem labels section:
  - Mislabeled examples
  - Unlabeled images
  - Ambiguous labels

### 4. Quality Assessment

**Purpose:** Data quality exploration and filtering

**Elements:**
- Quality distribution chart
- Side-by-side comparison:
  - "Good" examples
  - "Bad" examples
- Filter threshold sliders:
  - White pixel percentage
  - File size
  - Dimension constraints
- Preview of filtered dataset:
  - Count after filtering
  - Sample images that would be removed
- Export filtered list button

### 5. Insights Summary

**Purpose:** Key findings and recommendations

**Elements:**
- Critical findings (with evidence links)
- Data strengths / weaknesses
- Model recommendations table
- Training considerations
- Next steps / action items

---

## Technical Requirements

### Dependencies

```python
# requirements.txt
streamlit>=1.28.0
pillow>=10.0.0
pandas>=2.0.0
numpy>=1.24.0
plotly>=5.17.0  # For interactive charts
opencv-python>=4.8.0  # Optional, for advanced image processing
```

### Performance Considerations

- **Lazy Loading:** Don't load all images into memory at once
- **Caching:** Use `@st.cache_data` for expensive computations
- **Thumbnails:** Generate thumbnails for grid view (don't load full resolution)
- **Pagination:** Limit images per page (default: 50)

### Code Patterns

```python
# Example: Image browser with caching
import streamlit as st
from PIL import Image
import os

@st.cache_data
def load_image_metadata(image_dir):
    """Load metadata for all images (not the images themselves)."""
    # Return list of dicts with path, size, dimensions
    pass

@st.cache_data
def load_thumbnail(image_path, max_size=(200, 200)):
    """Load and resize image for thumbnail view."""
    img = Image.open(image_path)
    img.thumbnail(max_size)
    return img

def display_image_grid(images, cols=5):
    """Display images in a grid layout."""
    for i in range(0, len(images), cols):
        cols_list = st.columns(cols)
        for j, col in enumerate(cols_list):
            if i + j < len(images):
                with col:
                    st.image(images[i + j])
```

---

## User Interaction Patterns

### Filtering

- Sidebar for global filters
- Apply button (don't filter on every change for large datasets)
- Clear filters button
- Show count of matching images

### Image Selection

- Click to select
- Shift+click for range selection
- Checkbox for multi-select
- "Select all filtered" button

### Export

- Export filtered image list (CSV)
- Export current view as image
- Download selected images (zip)

---

## Styling Guidelines

### Theme

- Use Streamlit's default theme (light/dark mode support)
- Consistent color scheme for quality levels:
  - High quality: Green (#28a745)
  - Medium quality: Yellow (#ffc107)
  - Low quality: Red (#dc3545)

### Layout

- Wide layout enabled: `st.set_page_config(layout="wide")`
- Sidebar for navigation and filters
- Main area for content
- Responsive to screen size

### Accessibility

- Alt text for images
- Keyboard navigation support
- Sufficient color contrast
- Clear labels and headers

---

## State Management

```python
# Session state for user selections
if 'selected_images' not in st.session_state:
    st.session_state.selected_images = []

if 'current_filters' not in st.session_state:
    st.session_state.current_filters = {
        'class': None,
        'quality': None,
        'format': None
    }
```

---

## Integration Points

### Data Sources

- Read from `experiments/eda/*.py` outputs
- Load insights from `experiments/eda/06_insights.md`
- Reference `eda-report-images.md` for statistics

### Config

- Read `_bmad/bmds/config.yaml` for paths
- Support environment variables for deployment

### Deployment (Optional)

- Can run locally: `streamlit run app.py`
- Can deploy to Streamlit Cloud
- Docker support for team sharing
